<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Emoji Memory Match</title>
    
    <!-- Google Fonts for a friendly look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #87CEEB; /* Sky Blue */
            --card-front-color: #ffca28; /* Sunny Yellow */
            --card-back-color: #ffffff;
            --text-color: #ffffff;
            --font-family: 'Fredoka One', cursive;
            --grid-gap: 10px;
        }

        /* Basic Setup */
        * { box-sizing: border-box; }
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; font-family: var(--font-family);
            background-color: var(--bg-color);
            display: flex; align-items: center; justify-content: center;
        }

        /* Main Game Container */
        #game-container {
            width: 100%; height: 100%;
            max-width: 800px; max-height: 900px;
            display: flex; flex-direction: column;
            padding: 10px;
        }

        /* Top Info Bar */
        #info-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-color);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            padding: 10px;
            font-size: clamp(1rem, 4vw, 1.5rem);
            flex-wrap: wrap;
        }

        /* Game Board Grid */
        #game-board {
            flex-grow: 1;
            display: grid;
            gap: var(--grid-gap);
            padding: var(--grid-gap);
        }

        /* Card Styling & Flip Animation */
        .card {
            background-color: transparent;
            perspective: 1000px; /* For 3D flip effect */
            cursor: pointer;
        }
        .card-inner {
            position: relative;
            width: 100%; height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            border-radius: 10px;
        }
        .card.is-flipped .card-inner {
            transform: rotateY(180deg);
        }
        .card-face {
            position: absolute;
            width: 100%; height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(2rem, 10vw, 4rem);
        }
        .card-front {
            background-color: var(--card-front-color);
            color: var(--text-color);
        }
        .card-back {
            background-color: var(--card-back-color);
            transform: rotateY(180deg);
        }
        .card.is-matched {
            opacity: 0.7;
            pointer-events: none; /* Can't click matched cards */
        }
        .card.is-matched .card-inner {
            box-shadow: 0 0 10px #66bb6a; /* Green glow for matched cards */
        }

        /* Modal for Level Complete / Game Win */
        .modal-overlay {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6);
            display: none; /* Hidden by default */
            align-items: center; justify-content: center;
            z-index: 100;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            color: #333;
        }
        .modal-content h2 { font-size: 2.5rem; margin-top: 0; }
        .modal-content p { font-size: 1.2rem; }
        .modal-button {
            padding: 15px 30px; font-size: 1.5rem;
            font-family: var(--font-family); border-radius: 15px; border: none;
            background-color: var(--card-front-color); color: white;
            cursor: pointer; box-shadow: 0 4px 0 #c79a1a;
            transition: all 0.1s;
        }
        .modal-button:active { transform: translateY(2px); box-shadow: 0 2px 0 #c79a1a; }
    </style>
</head>
<body>

    <!-- Main Game Container -->
    <div id="game-container">
        <!-- Info Bar for Level, Tries, and Time -->
        <div id="info-bar">
            <span id="level-display">Level: 1</span>
            <span id="tries-display">Tries: 0</span>
            <span id="timer-display">‚è±Ô∏è 0:00</span>
        </div>

        <!-- The grid where cards will be placed -->
        <div id="game-board"></div>
    </div>

    <!-- Modal for showing "Next Level" or "Play Again" -->
    <div class="modal-overlay" id="win-modal">
        <div class="modal-content">
            <h2 id="win-title">Level Complete!</h2>
            <p id="win-stats">You did it in 0 tries and 0:00 time.</p>
            <button class="modal-button" id="next-level-btn">Next Level</button>
        </div>
    </div>

    <!-- Placeholder audio files -->
    <audio id="flip-sound" src="assets/flip.mp3"></audio>
    <audio id="match-sound" src="assets/match.mp3"></audio>
    <audio id="fail-sound" src="assets/fail.mp3"></audio>
    <audio id="win-sound" src="assets/win.mp3"></audio>
    <audio id="bg-music" src="assets/bg-music.mp3" loop></audio>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- DOM Elements ---
            const gameBoard = document.getElementById('game-board');
            const levelDisplay = document.getElementById('level-display');
            const triesDisplay = document.getElementById('tries-display');
            const timerDisplay = document.getElementById('timer-display');
            const winModal = document.getElementById('win-modal');
            const winTitle = document.getElementById('win-title');
            const winStats = document.getElementById('win-stats');
            const nextLevelBtn = document.getElementById('next-level-btn');

            // --- Audio Elements ---
            const sounds = {
                flip: document.getElementById('flip-sound'),
                match: document.getElementById('match-sound'),
                fail: document.getElementById('fail-sound'),
                win: document.getElementById('win-sound'),
                music: document.getElementById('bg-music')
            };

            // --- Game Configuration & State ---
            const EMOJIS = ['üê∂', 'üò∫', 'üçé', 'üê∞', 'üåü', 'üç©', 'üöó', 'ü¶ã', 'üê∏', 'üçï', 'üçì', 'üçå', 'üêù', 'üéà', 'üß∏', '‚öΩ'];
            const levelConfig = [
                { pairs: 2, grid: '2x2' },
                { pairs: 3, grid: '3x2' },
                { pairs: 6, grid: '4x3' },
                { pairs: 8, grid: '4x4' },
                { pairs: 10, grid: '5x4' },
                { pairs: 12, grid: '6x4' }
            ];

            let currentLevel = 0;
            let firstCard = null;
            let secondCard = null;
            let hasFlippedCard = false;
            let lockBoard = false; // Prevents clicking more than 2 cards at once
            let tries = 0;
            let matchesFound = 0;
            
            // Timer state
            let timerInterval;
            let seconds = 0;

            // --- Game Logic ---

            /**
             * Initializes and starts a new level.
             */
            function startLevel() {
                // Reset board and state
                gameBoard.innerHTML = '';
                tries = 0;
                matchesFound = 0;
                hasFlippedCard = false;
                lockBoard = false;
                
                // Update displays
                levelDisplay.textContent = `Level: ${currentLevel + 1}`;
                triesDisplay.textContent = `Tries: 0`;

                // Set up grid layout
                const config = levelConfig[currentLevel];
                const [cols, rows] = config.grid.split('x');
                gameBoard.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
                gameBoard.style.gridTemplateRows = `repeat(${rows}, 1fr)`;

                // Prepare and shuffle cards
                const emojiSubset = shuffleArray([...EMOJIS]).slice(0, config.pairs);
                const cardsToPlace = shuffleArray([...emojiSubset, ...emojiSubset]);

                // Create and add cards to the board
                cardsToPlace.forEach(emoji => {
                    createCard(emoji);
                });

                // Start timer and music
                startTimer();
                // Play background music (requires user interaction)
                sounds.music.play().catch(() => {});
            }
            
            /**
             * Creates a single card element and appends it to the game board.
             */
            function createCard(emoji) {
                const card = document.createElement('div');
                card.classList.add('card');
                card.dataset.emoji = emoji;

                card.innerHTML = `
                    <div class="card-inner">
                        <div class="card-face card-front">?</div>
                        <div class="card-face card-back">${emoji}</div>
                    </div>
                `;
                
                card.addEventListener('click', flipCard);
                gameBoard.appendChild(card);
            }

            /**
             * Handles the logic when a card is clicked.
             */
            function flipCard() {
                if (lockBoard) return; // Board is locked, do nothing
                if (this === firstCard) return; // Can't click the same card twice

                this.classList.add('is-flipped');
                playSound('flip');

                if (!hasFlippedCard) {
                    // First card flipped
                    hasFlippedCard = true;
                    firstCard = this;
                } else {
                    // Second card flipped
                    secondCard = this;
                    hasFlippedCard = false;
                    checkForMatch();
                }
            }

            /**
             * Checks if the two flipped cards are a match.
             */
            function checkForMatch() {
                tries++;
                triesDisplay.textContent = `Tries: ${tries}`;
                
                const isMatch = firstCard.dataset.emoji === secondCard.dataset.emoji;
                isMatch ? disableCards() : unflipCards();
            }

            /**
             * If cards match, disables them and checks for a win.
             */
            function disableCards() {
                playSound('match');
                firstCard.classList.add('is-matched');
                secondCard.classList.add('is-matched');
                
                firstCard.removeEventListener('click', flipCard);
                secondCard.removeEventListener('click', flipCard);
                
                matchesFound++;
                if (matchesFound === levelConfig[currentLevel].pairs) {
                    setTimeout(levelComplete, 500);
                }
                
                resetBoardState();
            }

            /**
             * If cards don't match, flips them back.
             */
            function unflipCards() {
                lockBoard = true; // Lock the board while cards are un-flipping
                playSound('fail');

                setTimeout(() => {
                    firstCard.classList.remove('is-flipped');
                    secondCard.classList.remove('is-flipped');
                    resetBoardState();
                }, 1000);
            }

            /**
             * Resets the flipped card state after a turn.
             */
            function resetBoardState() {
                [hasFlippedCard, lockBoard] = [false, false];
                [firstCard, secondCard] = [null, null];
            }

            /**
             * Handles the logic when all pairs in a level are found.
             */
            function levelComplete() {
                stopTimer();
                playSound('win');
                sounds.music.pause();
                
                // Show completion modal
                winModal.style.display = 'flex';
                winStats.textContent = `You did it in ${tries} tries and ${formatTime(seconds)}!`;
                
                if (currentLevel >= levelConfig.length - 1) {
                    // Game completed
                    winTitle.textContent = "You Win!";
                    nextLevelBtn.textContent = "Play Again";
                } else {
                    winTitle.textContent = "Level Complete!";
                    nextLevelBtn.textContent = "Next Level";
                }
            }
            
            // --- Helper Functions ---

            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            function playSound(soundName) {
                if (sounds[soundName]) {
                    sounds[soundName].currentTime = 0;
                    sounds[soundName].play();
                }
            }

            function startTimer() {
                stopTimer(); // Ensure no multiple timers are running
                seconds = 0;
                timerDisplay.textContent = `‚è±Ô∏è ${formatTime(seconds)}`;
                timerInterval = setInterval(() => {
                    seconds++;
                    timerDisplay.textContent = `‚è±Ô∏è ${formatTime(seconds)}`;
                }, 1000);
            }

            function stopTimer() {
                clearInterval(timerInterval);
            }

            function formatTime(sec) {
                const minutes = Math.floor(sec / 60);
                const remainingSeconds = sec % 60;
                return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
            }

            // --- Event Listeners ---
            
            nextLevelBtn.addEventListener('click', () => {
                winModal.style.display = 'none';
                if (currentLevel >= levelConfig.length - 1) {
                    currentLevel = 0; // Reset to level 1
                } else {
                    currentLevel++;
                }
                startLevel();
            });

            // --- Initial Game Start ---
            startLevel();

        });
    </script>
</body>
</html>
